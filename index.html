<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Hand Cricket v2</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: #000;
    font-family: system-ui, sans-serif;
    color: #fff;
  }

  /* HUD box */
  #hud {
    position: absolute;
    top: 15px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.6);
    border: 1px solid rgba(255,255,255,0.15);
    border-radius: 8px;
    padding: 10px 16px;
    min-width: 260px;
    text-align: center;
    line-height: 1.4;
    color: #fff;
    text-shadow: 0 2px 4px rgba(0,0,0,0.7);
    user-select: none;
    pointer-events: none;
    font-size: 14px;
  }
  #titleText {
    font-size: 16px;
    font-weight: 600;
    margin-top: 6px;
  }

  /* Control panel */
  #controls {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    background: rgba(0,0,0,0.5);
    border: 1px solid rgba(255,255,255,0.15);
    border-radius: 8px;
    padding: 12px 16px;
    text-align: center;
  }

  #controls button {
    background: #222;
    color: #fff;
    border: 1px solid #555;
    border-radius: 6px;
    padding: 10px 14px;
    min-width: 44px;
    font-size: 16px;
    cursor: pointer;
    font-family: inherit;
    line-height: 1.2;
  }

  #controls button:active {
    background: #444;
  }

  #resetBtn {
    display: none;
    background: #8b1a1a;
    border-color: #c33;
  }
  #resetBtn:active {
    background: #a02222;
  }

  #errorBox {
    position: absolute;
    bottom: 10px;
    left: 10px;
    background: rgba(255,0,0,0.15);
    border: 1px solid rgba(255,0,0,0.5);
    padding: 8px 12px;
    border-radius: 4px;
    font-size: 12px;
    line-height: 1.4;
    color: #ff8080;
    max-width: 360px;
    white-space: pre-line;
    user-select: text;
    display: none;
  }
</style>
</head>
<body>
  <div id="hud">
    <div id="scoreLine">Runs: 0</div>
    <div id="lastLine">You: - | Opponent: -</div>
    <div id="statusLine">Choose your number.</div>
    <div id="titleText">Hand Cricket Prototype</div>
  </div>

  <div id="controls">
    <button class="numBtn" data-val="1">1</button>
    <button class="numBtn" data-val="2">2</button>
    <button class="numBtn" data-val="3">3</button>
    <button class="numBtn" data-val="4">4</button>
    <button class="numBtn" data-val="5">5</button>
    <button class="numBtn" data-val="6">6</button>
    <button id="resetBtn">Play Again</button>
  </div>

  <div id="errorBox"></div>

  <!-- MUST be local in same folder -->
  <script src="three.js"></script>
  <script>
  try {

    /**********************************
     * 1. GAME STATE
     **********************************/
    let totalRuns = 0;
    let lastPlayerVal = '-';
    let lastEnemyVal = '-';
    let gameState = 'playing'; // 'playing' | 'out'

    const scoreLine   = document.getElementById('scoreLine');
    const lastLine    = document.getElementById('lastLine');
    const statusLine  = document.getElementById('statusLine');
    const resetBtn    = document.getElementById('resetBtn');

    function updateHUD() {
      scoreLine.textContent  = `Runs: ${totalRuns}`;
      lastLine.textContent   = `You: ${lastPlayerVal} | Opponent: ${lastEnemyVal}`;
      statusLine.textContent =
        (gameState === 'playing')
        ? 'Choose your number.'
        : 'OUT! Tap "Play Again".';
    }

    function setOutState() {
      gameState = 'out';
      resetBtn.style.display = 'inline-block';
      updateHUD();
    }

    function resetGame() {
      totalRuns = 0;
      lastPlayerVal = '-';
      lastEnemyVal = '-';
      gameState = 'playing';
      resetBtn.style.display = 'none';
      updateHUD();
      // visual: show something like "neutral" open hand
      setHandNumber('player', 5);
      setHandNumber('enemy',  5);
    }

    /**********************************
     * 2. THREE.JS SETUP
     **********************************/
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x0f2228); // teal / navy

    const camera = new THREE.PerspectiveCamera(
      45,
      window.innerWidth / window.innerHeight,
      0.1,
      100
    );
    camera.position.set(0, 5, 8);
    camera.lookAt(0, 1.5, 0);

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.shadowMap.enabled = true;
    renderer.shadowMap.type = THREE.PCFSoftShadowMap;
    document.body.appendChild(renderer.domElement);

    // Lights
    const ambient = new THREE.AmbientLight(0xffffff, 0.3);
    scene.add(ambient);

    const keyLight = new THREE.DirectionalLight(0xffffff, 1.2);
    keyLight.position.set(-3, 6, 4);
    keyLight.castShadow = true;
    keyLight.shadow.mapSize.width = 1024;
    keyLight.shadow.mapSize.height = 1024;
    keyLight.shadow.camera.near = 0.5;
    keyLight.shadow.camera.far = 20;
    keyLight.shadow.camera.left = -5;
    keyLight.shadow.camera.right = 5;
    keyLight.shadow.camera.top = 5;
    keyLight.shadow.camera.bottom = -5;
    scene.add(keyLight);

    // Table + ground
    const tableMat = new THREE.MeshStandardMaterial({
      color: 0x5a4a1f,
      roughness: 0.7,
      metalness: 0.0
    });

    const tableTopGeo = new THREE.BoxGeometry(6, 0.4, 4);
    const tableTop = new THREE.Mesh(tableTopGeo, tableMat);
    tableTop.position.set(0, 1.5, 0);
    tableTop.receiveShadow = true;
    tableTop.rotation.y = 0.15;
    scene.add(tableTop);

    function makeLeg(x, z) {
      const legGeo = new THREE.BoxGeometry(0.4, 2.0, 0.4);
      const leg = new THREE.Mesh(legGeo, tableMat);
      leg.position.set(x, 0.5, z);
      leg.castShadow = true;
      leg.receiveShadow = true;
      scene.add(leg);
    }
    makeLeg( 2.5,  1.5);
    makeLeg(-2.5,  1.5);
    makeLeg( 2.5, -1.5);
    makeLeg(-2.5, -1.5);

    const groundMat = new THREE.MeshStandardMaterial({
      color: 0x0a0a0a,
      roughness: 1.0,
      metalness: 0.0
    });
    const groundGeo = new THREE.PlaneGeometry(20, 20);
    const ground = new THREE.Mesh(groundGeo, groundMat);
    ground.rotation.x = -Math.PI / 2;
    ground.position.y = 0;
    ground.receiveShadow = true;
    scene.add(ground);

    /**********************************
     * 3. HANDS (BLOCK-STYLE FOR NOW)
     **********************************/
    function makeBlock(w,h,d,colorHex) {
      const geo = new THREE.BoxGeometry(w,h,d);
      const mat = new THREE.MeshStandardMaterial({
        color: colorHex,
        roughness: 0.6,
        metalness: 0.0
      });
      const mesh = new THREE.Mesh(geo, mat);
      mesh.castShadow = true;
      mesh.receiveShadow = true;
      return mesh;
    }

    function makeFinger(len, thick, colorHex) {
      const geo = new THREE.BoxGeometry(len, thick, thick);
      const mat = new THREE.MeshStandardMaterial({
        color: colorHex,
        roughness: 0.6,
        metalness: 0.0
      });
      const m = new THREE.Mesh(geo, mat);
      m.castShadow = true;
      m.receiveShadow = true;
      return m;
    }

    // Player hand (green)
    const PLAYER_COLOR = 0x5b8050;
    const playerHand = new THREE.Group();
    scene.add(playerHand);

    const playerPalm = makeBlock(2.2,0.5,1.2,PLAYER_COLOR);
    playerPalm.position.set(0,0,0);
    playerHand.add(playerPalm);

    const playerFingers = [];
    const pSpacing = 0.35;
    for (let i=0; i<4; i++){
      const f = makeFinger(1.4,0.25,PLAYER_COLOR);
      f.position.set(1.2,0.15,(i-1.5)*pSpacing);
      playerHand.add(f);
      playerFingers.push(f);
    }
    const playerThumb = makeFinger(0.8,0.3,PLAYER_COLOR);
    playerThumb.position.set(0.8,-0.05,-0.8);
    playerThumb.rotation.y = -0.5;
    playerHand.add(playerThumb);

    playerHand.rotation.x = -0.3;
    playerHand.rotation.y = 0.35 + 0.15;
    playerHand.position.set(-1.5,1.8,-0.5);

    // Enemy hand (skin tone)
    const ENEMY_COLOR = 0xd9a477;
    const enemyHand = new THREE.Group();
    scene.add(enemyHand);

    const enemyPalm = makeBlock(2.0,1.0,1.4,ENEMY_COLOR);
    enemyPalm.position.set(0,0,0);
    enemyHand.add(enemyPalm);

    const enemyFingers = [];
    const eSpacing = 0.4;
    for (let i=0; i<4; i++){
      const knuckle = makeBlock(1.0,0.5,0.5,ENEMY_COLOR);
      knuckle.position.set(1.0,0.3-(i*0.02),(i-1.5)*eSpacing);
      enemyHand.add(knuckle);
      enemyFingers.push(knuckle);
    }

    const enemyThumb = makeBlock(0.8,0.5,0.5,ENEMY_COLOR);
    enemyThumb.position.set(-0.6,-0.2,0.8);
    enemyThumb.rotation.z = 0.4;
    enemyHand.add(enemyThumb);

    const enemyWrist = makeBlock(0.8,0.8,1.0,ENEMY_COLOR);
    enemyWrist.position.set(-1.2,-0.2,0);
    enemyWrist.rotation.z = 0.2;
    enemyHand.add(enemyWrist);

    enemyHand.rotation.x = -0.2;
    enemyHand.rotation.y = -0.6 - 0.1;
    enemyHand.position.set(1.5,1.9,0.5);

    /**********************************
     * 4. HAND POSE FUNCTION
     * setHandNumber("player"|"enemy", n)
     **********************************/
    function setHandNumber(which, num){
      const isPlayer = (which === "player");
      const fingersArr = isPlayer ? playerFingers : enemyFingers;
      const thumbObj   = isPlayer ? playerThumb   : enemyThumb;

      // how many long fingers up?
      // 1->1,2->2,3->3,4->4,5->4,6->4
      let longUp = (num <=4) ? num : 4;

      // thumb out for 5 or 6
      const thumbUp = (num >=5);

      // spread factor for "6" (fan fingers wider)
      const spread = (num === 6) ? 1.2 : 1.0;

      // apply to each of 4 long fingers
      for (let i=0;i<fingersArr.length;i++){
        const f = fingersArr[i];
        if (i < longUp){
          // extended
          f.scale.set(1,1,1);
          if (isPlayer){
            f.position.x = 1.2;
            f.position.y = 0.15;
            f.position.z = (i-1.5)*pSpacing*spread;
          } else {
            f.position.x = 1.0;
            f.position.y = 0.3-(i*0.02);
            f.position.z = (i-1.5)*eSpacing*spread;
          }
        } else {
          // folded
          f.scale.set(0.25,0.25,0.25);
          if (isPlayer){
            f.position.x = 0.4;
            f.position.y = 0.05;
            f.position.z = (i-1.5)*0.15;
          } else {
            f.position.x = 0.3;
            f.position.y = 0.1;
            f.position.z = (i-1.5)*0.15;
          }
        }
      }

      // thumb
      if (thumbObj){
        if (thumbUp){
          thumbObj.scale.set(1,1,1);
          if (isPlayer){
            thumbObj.position.set(0.8,-0.05,-0.8);
            thumbObj.rotation.set(0,-0.5,0);
          } else {
            thumbObj.position.set(-0.6,-0.2,0.8);
            thumbObj.rotation.set(0,0,0.4);
          }
        } else {
          thumbObj.scale.set(0.25,0.25,0.25);
          if (isPlayer){
            thumbObj.position.set(0.3,-0.1,-0.4);
            thumbObj.rotation.set(0,0,0);
          } else {
            thumbObj.position.set(-0.4,-0.4,0.2);
            thumbObj.rotation.set(0,0,0);
          }
        }
      }
    }

    // default neutral pose
    setHandNumber("player",5);
    setHandNumber("enemy",5);

    /**********************************
     * 5. CORE TURN LOGIC
     **********************************/
    function playTurn(playerChoice){
      if (gameState !== 'playing') return;

      const enemyChoice = 1 + Math.floor(Math.random()*6);

      lastPlayerVal = playerChoice;
      lastEnemyVal  = enemyChoice;

      // animate both hands to show chosen number
      setHandNumber("player", playerChoice);
      setHandNumber("enemy",  enemyChoice);

      // cricket rule:
      if (playerChoice === enemyChoice){
        // OUT
        setOutState();
      } else {
        // score runs = player's number
        totalRuns += playerChoice;
        updateHUD();
      }
    }

    /**********************************
     * 6. BUTTON HOOKUP
     **********************************/
    document.querySelectorAll('.numBtn').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const val = parseInt(btn.dataset.val,10);
        playTurn(val);
      });
    });

    resetBtn.addEventListener('click', ()=>{
      resetGame();
    });

    updateHUD();

    /**********************************
     * 7. IDLE ANIMATION LOOP
     **********************************/
    function animate(){
      requestAnimationFrame(animate);

      // subtle breathing motion
      const t = performance.now()*0.001;
      playerHand.position.y = 1.8 + Math.sin(t*1.5)*0.02;
      enemyHand.position.y  = 1.9 + Math.sin(t*1.5+1.2)*0.02;

      renderer.render(scene,camera);
    }
    animate();

    /**********************************
     * 8. HANDLE RESIZE
     **********************************/
    window.addEventListener("resize", ()=>{
      camera.aspect = window.innerWidth/window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth,window.innerHeight);
    });

  } catch(err){
    const errorBox = document.getElementById('errorBox');
    errorBox.style.display = 'block';
    errorBox.textContent =
      "ERROR (JS crashed):\n" + err.message + "\n" + err.stack;
    console.error(err);
  }
  </script>
</body>
</html>
